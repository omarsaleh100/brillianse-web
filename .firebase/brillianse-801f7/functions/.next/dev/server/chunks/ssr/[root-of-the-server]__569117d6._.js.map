{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/omarsaleh/Desktop/python/brillianse/frontend/lib/firebase.js"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\";\nimport { getAuth } from \"firebase/auth\";\nimport { getFirestore } from \"firebase/firestore\";\nimport { getStorage } from \"firebase/storage\";\n\n// Read keys from the .env.local file\nconst firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID\n};\n\n// Initialize Firebase\nconst app = !getApps().length ? initializeApp(firebaseConfig) : getApp();\nconst db = getFirestore(app);\nconst auth = getAuth(app);\nconst storage = getStorage(app);\n\nexport { app, db, auth, storage };"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;;;;;AAEA,qCAAqC;AACrC,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACP;AAEA,sBAAsB;AACtB,MAAM,MAAM,CAAC,IAAA,2KAAO,IAAG,MAAM,GAAG,IAAA,iLAAa,EAAC,kBAAkB,IAAA,0KAAM;AACtE,MAAM,KAAK,IAAA,iLAAY,EAAC;AACxB,MAAM,OAAO,IAAA,6KAAO,EAAC;AACrB,MAAM,UAAU,IAAA,kMAAU,EAAC"}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///Users/omarsaleh/Desktop/python/brillianse/frontend/app/profile/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport Head from 'next/head';\nimport { db, auth, storage } from '../../lib/firebase'; // <-- Import storage\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\nimport { onAuthStateChanged, User, signOut } from 'firebase/auth';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { \n  ref, \n  uploadBytesResumable, \n  getDownloadURL \n} from 'firebase/storage';\n\nconst DEFAULT_AVATAR_URL = 'https://firebasestorage.googleapis.com/v0/b/brillianse-801f7.firebasestorage.app/o/logos%2FBrillianse%20(5)%20copy.png?alt=media&token=ecffd21e-dff9-4151-b57f-5515be4c87e7';\n\nexport default function Profile() {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  \n  const [error, setError] = useState<string | null>(null);\n  const [validationError, setValidationError] = useState<string | null>(null);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n\n  const [form, setForm] = useState({\n    username: '',\n    twitter: '',\n    linkedin: '',\n    instagram: '',\n  });\n  \n  const [dailyGroupId, setDailyGroupId] = useState<string | null>(null);\n  \n  const [profilePicUrl, setProfilePicUrl] = useState<string | null>(null);\n  const [imageFile, setImageFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [isProfileComplete, setIsProfileComplete] = useState(false);\n  \n  const router = useRouter();\n\n  // --- 1. Listen for user and load profile ---\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\n      if (currentUser) {\n        setUser(currentUser);\n        const userRef = doc(db, 'users', currentUser.uid);\n        const docSnap = await getDoc(userRef);\n        \n        if (docSnap.exists()) {\n          const data = docSnap.data();\n          setIsProfileComplete(data.isProfileComplete || false);\n\n          let suggestedUsername = data.username || '';\n          if (!data.isProfileComplete) {\n            const name = currentUser.email?.split('@')[0].replace(/[^a-zA-Z0-9]/g, '') || 'user';\n            suggestedUsername = `${name}${Math.floor(100 + Math.random() * 900)}`;\n          }\n          setForm({\n            username: data.username || suggestedUsername,\n            twitter: data.socials?.twitter || '',\n            linkedin: data.socials?.linkedin || '',\n            instagram: data.socials?.instagram || '',\n          });\n          setProfilePicUrl(data.profilePictureUrl || null);\n          if (data.dailyGroup?.groupId) {\n            setDailyGroupId(data.dailyGroup.groupId);\n          }\n        }\n      } else {\n        router.push('/');\n      }\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, [router]);\n  \n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { id, value } = e.target;\n    setForm(prev => ({ ...prev, [id]: value }));\n  };\n  \n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files[0]) {\n      const file = e.target.files[0];\n      setImageFile(file);\n      setProfilePicUrl(URL.createObjectURL(file));\n    }\n  };\n\n  // --- 2. Handle Save Profile ---\n  const handleSave = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n\n    setError(null);\n    setSuccessMessage(null);\n    setValidationError(null);\n\n    const { username, twitter, linkedin, instagram } = form; // <-- CHANGED\n    if (!username) {\n      setValidationError('Username is required.');\n      return;\n    }\n    if (!twitter && !linkedin && !instagram) {\n      setValidationError('Please add at least one social media handle.');\n      return;\n    }\n\n    try {\n      let finalProfilePicUrl = profilePicUrl; \n\n      if (imageFile) {\n        setIsUploading(true);\n        const storageRef = ref(storage, `profile_pictures/${user.uid}`);\n        const uploadTask = uploadBytesResumable(storageRef, imageFile);\n\n        await new Promise<void>((resolve, reject) => {\n          uploadTask.on(\n            'state_changed',\n            (snapshot) => {\n              const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n              setUploadProgress(progress);\n            },\n            (error) => {\n              console.error('Upload failed:', error);\n              setError('Image upload failed. Please try again.');\n              reject(error);\n            },\n            async () => {\n              const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);\n              finalProfilePicUrl = downloadURL;\n              setIsUploading(false);\n              setImageFile(null);\n              resolve();\n            }\n          );\n        });\n      }\n\n      const userRef = doc(db, 'users', user.uid);\n      \n      await setDoc(userRef, {\n        username: username,\n        email: user.email,\n        socials: {\n          twitter: twitter,\n          linkedin: linkedin,\n          instagram: instagram,\n        },\n        profilePictureUrl: finalProfilePicUrl,\n        isProfileComplete: true\n      }, { merge: true });\n\n      setSuccessMessage('Profile saved! Redirecting to your group...');\n\n      setTimeout(() => {\n        if (dailyGroupId) {\n          router.push(`/group/${dailyGroupId}`);\n        } else {\n          router.push('/');\n        }\n      }, 2000);\n\n    } catch (err) {\n      if (!isUploading) {\n        console.error(err);\n        setError('Failed to save profile. Please try again.');\n      }\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  // --- 3. Handle Sign Out ---\n  const handleSignOut = async () => {\n    try {\n      await signOut(auth);\n    } catch (err) {\n      console.error('Failed to sign out:', err);\n    }\n  };\n\n  if (loading) {\n    return <main className=\"loading-container\">Loading profile...</main>;\n  }\n\n  return (\n    <main> {/* This is the main flex-column container */}\n      <Head>\n        <title>My Profile</title>\n      </Head>\n\n      {/* --- NEW: Wrapper for side-by-side layout --- */}\n      <div className=\"profile-content-wrapper\">\n\n        {/* --- MODIFIED: Wrapper for the button --- */}\n        <div className=\"profile-nav-wrapper\">\n          {dailyGroupId && isProfileComplete && (\n            <div className=\"page-nav-header\">\n              <Link href={`/group/${dailyGroupId}`}>\n                &larr;\n              </Link>\n            </div>\n          )}\n        </div>\n        {/* ---------------------------- */}\n\n        <form onSubmit={handleSave} className=\"profile-form\">\n          <h1>Your Profile</h1>\n          <p>This is what other users in your group will see.</p>\n\n          {successMessage && <div className=\"success-message\">{successMessage}</div>}\n          {error && <div className=\"error-container\">{error}</div>}\n          {validationError && <div className=\"validation-error\">{validationError}</div>}\n\n          <div className=\"pfp-uploader\">\n            <label htmlFor=\"file-input\">\n              <img \n                src={profilePicUrl || DEFAULT_AVATAR_URL} \n                alt=\"Profile\" \n                className=\"pfp-preview\"\n                onError={(e) => (e.currentTarget.src = DEFAULT_AVATAR_URL)}/>\n              <span className=\"pfp-edit-text\">Click to change</span>\n            </label>\n            <input \n              id=\"file-input\" \n              type=\"file\" \n              accept=\"image/png, image/jpeg\"\n              onChange={handleFileChange}\n            />\n          </div>\n          \n          {isUploading && (\n            <div className=\"upload-progress-bar\">\n              <div style={{ width: `${uploadProgress}%` }}></div>\n            </div>\n          )}\n\n          <div className=\"input-group\">\n            <label htmlFor=\"username\">Username</label>\n            <input id=\"username\" type=\"text\" value={form.username} onChange={handleChange} />\n          </div>\n          <div className=\"input-group\">\n            <label htmlFor=\"twitter\">Twitter Handle</label>\n            <input id=\"twitter\" type=\"text\" value={form.twitter} onChange={handleChange} />\n          </div>\n          <div className=\"input-group\">\n            <label htmlFor=\"linkedin\">LinkedIn Profile</label>\n            <input id=\"linkedin\" type=\"text\" value={form.linkedin} onChange={handleChange} />\n          </div>\n          <div className=\"input-group\">\n            <label htmlFor=\"instagram\">Instagram Handle</label>\n            <input id=\"instagram\" type=\"text\" value={form.instagram} onChange={handleChange} placeholder=\"@username\" />\n          </div>\n\n          <button type=\"submit\" className=\"btn-submit\" disabled={isUploading}>\n            {isUploading ? `Uploading... ${uploadProgress.toFixed(0)}%` : 'Save Profile'}\n          </button>\n        </form>\n        <div className=\"profile-nav-wrapper\">\n          {/* This spacer is intentionally left empty */}\n          {/* It will take up the same space as the button wrapper */}\n          {dailyGroupId && isProfileComplete && (\n            <div className=\"page-nav-header\" style={{ visibility: 'hidden' }}>\n              <Link href={`/group/${dailyGroupId}`}>\n                &larr;\n              </Link>\n            </div>\n          )}\n        </div>\n      </div>\n      {/* --- End of new wrapper --- */}\n\n\n      <button onClick={handleSignOut} className=\"btn-sign-out-profile\" disabled={isUploading}>\n        Sign Out\n      </button>\n    </main>\n  );\n}"],"names":[],"mappings":"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"}}]
}