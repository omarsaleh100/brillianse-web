(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31713,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(36159),l=e.i(52636);e.i(36180);var r=e.i(98925);e.i(51718);var i=e.i(18357),o=e.i(18566);function n(){return new Date().toISOString().split("T")[0]}function u(){let[e,u]=(0,a.useState)([]),[c,d]=(0,a.useState)({}),[h,p]=(0,a.useState)(!0),[m,g]=(0,a.useState)(!0),[f,y]=(0,a.useState)(null),[x,j]=(0,a.useState)(null),[b,w]=(0,a.useState)(null),[v,N]=(0,a.useState)(""),[C,k]=(0,a.useState)(""),[S,P]=(0,a.useState)(""),[F,G]=(0,a.useState)(!1),[D,E]=(0,a.useState)("signup"),[$,I]=(0,a.useState)(null),[L,A]=(0,a.useState)(!1),[T,q]=(0,a.useState)(!1),[U,O]=(0,a.useState)(0),R=(0,o.useRouter)();(0,a.useEffect)(()=>{let e=(0,i.onAuthStateChanged)(l.auth,e=>{j(e),e||p(!1)});return()=>e()},[]),(0,a.useEffect)(()=>(F?document.body.classList.remove("no-scroll"):document.body.classList.add("no-scroll"),()=>document.body.classList.remove("no-scroll")),[F]),(0,a.useEffect)(()=>{(async()=>{if(!x)return p(!1);let e=(0,r.doc)(l.db,"users",x.uid),s=await (0,r.getDoc)(e),a=n();if(s.exists()){let e=s.data();if(!e.isProfileComplete)return R.push("/profile");if(e.groupFull&&e.groupFull.date===a){q(!0),p(!1);return}if(e.dailyGroup&&e.dailyGroup.date===a)return R.push(`/group/${e.dailyGroup.groupId}`)}p(!1)})()},[x,R]),(0,a.useEffect)(()=>{h||(async()=>{try{g(!0);let e=(0,r.doc)(l.db,"config","daily"),s=await (0,r.getDoc)(e);if(s.exists()){let e=s.data();e.date===n()?(u(e.questions||[]),O(0)):y("Questions for today are not ready yet. Check back soon!")}else y("Questions for today are not ready yet. Check back soon!")}catch(e){console.error(e),y("Failed to load questions. Please try refreshing.")}finally{g(!1)}})()},[h]),(0,a.useEffect)(()=>(document.body.classList.add("no-scroll"),()=>{document.body.classList.remove("no-scroll")}),[]);let B=async(s,a)=>{let t={...c,[s]:a};if(d(t),s===e.length-1){let s=e.map((e,s)=>"yes"===t[s]?"1":"0").join("");if(w(s),x){let e=await K(x,s,t);if("full"===e)q(!0);else if("success"===e){let e=(await (0,r.getDoc)((0,r.doc)(l.db,"users",x.uid))).data();G(!1),e?.isProfileComplete?R.push(`/group/${s}`):R.push("/profile")}}else G(!0)}else O(e=>e+1)},Q=async e=>{if(!v||!C)return void I("Please enter email and password.");if(e&&C!==S)return void I("Passwords do not match.");I(null);try{let s;e?(s=await (0,i.createUserWithEmailAndPassword)(l.auth,v,C),await (0,i.sendEmailVerification)(s.user)):s=await (0,i.signInWithEmailAndPassword)(l.auth,v,C);let a=s.user,t=n(),o=(0,r.doc)(l.db,"users",a.uid),u=await (0,r.getDoc)(o),d=u.exists()?u.data():null;if(d){if(d.groupFull&&d.groupFull.date===t){G(!1),q(!0);return}if(d.dailyGroup&&d.dailyGroup.date===t)return void G(!1)}if(e&&(await (0,r.setDoc)(o,{email:a.email,isProfileComplete:!1,username:a.email?.split("@")[0]||`user${Date.now()}`},{merge:!0}),d=(await (0,r.getDoc)(o)).data()||null),b){let e=await K(a,b,c);"full"===e?(G(!1),q(!0)):"success"===e&&(G(!1),d?.isProfileComplete?R.push(`/group/${b}`):R.push("/profile"))}else R.refresh()}catch(e){console.error("Auth error:",e),"auth/email-already-in-use"===e.code?I("This email is already in use."):"auth/weak-password"===e.code?I("Password must be at least 6 characters."):"auth/invalid-email"===e.code?I("Please enter a valid email address."):"auth/invalid-credential"===e.code?I("Invalid email or password."):I("An error occurred. Please try again.")}},W=async()=>{I(null);let e=new i.GoogleAuthProvider;try{let s=(await (0,i.signInWithPopup)(l.auth,e)).user,a=n(),t=(0,r.doc)(l.db,"users",s.uid),o=await (0,r.getDoc)(t),u=o.exists()?o.data():null;if(o.exists()||(u={email:s.email,isProfileComplete:!1,username:s.displayName||s.email?.split("@")[0]||`user${Date.now()}`,profilePictureUrl:s.photoURL||null},await (0,r.setDoc)(t,u,{merge:!0})),u){if(u.groupFull&&u.groupFull.date===a){G(!1),q(!0);return}if(u.dailyGroup&&u.dailyGroup.date===a)return void R.push(`/group/${u.dailyGroup.groupId}`)}if(b){let e=await K(s,b,c);"full"===e?(G(!1),q(!0)):"success"===e&&(G(!1),u?.isProfileComplete?R.push(`/group/${b}`):R.push("/profile"))}else R.refresh()}catch(e){console.error("Google join error:",e),I("Failed to sign in with Google.")}},Y=async()=>{try{await (0,i.signOut)(l.auth)}catch(e){console.error("Failed to sign out:",e),y("Failed to sign out.")}},K=async(s,a,t)=>{if(!s||!a)return"success";let i=n(),o=(0,r.doc)(l.db,"users",s.uid);try{return await (0,r.runTransaction)(l.db,async n=>{let u=(0,r.doc)(l.db,`daily_groups/${i}/groups`,a),c=await n.get(u),d=[];if(c.exists()&&(d=c.data().members||[]),d.length>=10&&!d.includes(s.uid))return n.set(o,{groupFull:{date:i}},{merge:!0}),"full";let h=e.map((e,s)=>t[s]);return n.set(u,{members:(0,r.arrayUnion)(s.uid)},{merge:!0}),n.set(o,{dailyGroup:{date:i,groupId:a,answers:h},groupFull:(0,r.deleteField)()},{merge:!0}),"success"})}catch(e){return console.error("Failed to assign group with transaction:",e),y("Error joining group. Please try again."),"success"}};return h||m?(0,s.jsx)("main",{className:"loading-container",children:(0,s.jsx)("p",{children:"Loading today's questions..."})}):(0,s.jsxs)("main",{children:[(0,s.jsx)(t.default,{children:(0,s.jsx)("title",{children:"Brillianse - Daily Questions"})}),!x&&!F&&(0,s.jsx)("div",{className:"header-actions",children:(0,s.jsx)("button",{className:"btn-sign-in-header",onClick:()=>{I(null),N(""),k(""),A(!0),P(""),E("login"),G(!0)},children:"Sign In"})}),F&&(0,s.jsx)("div",{className:"auth-container",children:"signup"===D?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("h2",{children:["You're in Group ",b,"!"]}),(0,s.jsx)("p",{children:"Sign up to see your group members."}),(0,s.jsxs)("div",{className:"auth-form",children:[(0,s.jsx)("input",{type:"email",value:v,onChange:e=>N(e.target.value),placeholder:"Email"}),(0,s.jsx)("input",{type:"password",value:C,onChange:e=>k(e.target.value),placeholder:"Password"}),(0,s.jsx)("input",{type:"password",value:S,onChange:e=>P(e.target.value),placeholder:"Confirm Password"}),(0,s.jsx)("button",{onClick:W,className:"btn-google",children:"Continue with Google"}),(0,s.jsx)("button",{onClick:()=>Q(!0),className:"btn-primary",children:"Sign Up"}),$&&(0,s.jsx)("p",{className:"auth-error",children:$})]}),(0,s.jsxs)("p",{className:"auth-toggle-link",children:["Already have an account? ",(0,s.jsx)("span",{onClick:()=>{E("login"),I(null)},children:"Log In"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{children:"Log In"}),(0,s.jsx)("p",{children:"Log in to see your group members."}),(0,s.jsxs)("div",{className:"auth-form",children:[(0,s.jsx)("input",{type:"email",value:v,onChange:e=>N(e.target.value),placeholder:"Email"}),(0,s.jsx)("input",{type:"password",value:C,onChange:e=>k(e.target.value),placeholder:"Password"}),(0,s.jsx)("button",{onClick:W,className:"btn-google",children:"Continue with Google"}),(0,s.jsx)("button",{onClick:()=>Q(!1),className:"btn-primary",children:"Log In with Email"}),$&&(0,s.jsx)("p",{className:"auth-error",children:$})]}),(0,s.jsxs)("p",{className:"auth-toggle-link",children:["Don't have an account? ",(0,s.jsx)("span",{onClick:()=>{E("signup"),I(null)},children:"Sign Up"})]})]})}),T&&(0,s.jsx)("div",{className:"sign-out-modal-overlay",children:(0,s.jsxs)("div",{className:"sign-out-modal-content",children:[(0,s.jsx)("h2",{children:"Group Full"}),(0,s.jsx)("p",{children:"This group already has 10 members. Please check back tomorrow!"}),(0,s.jsx)("div",{className:"modal-actions",children:(0,s.jsx)("button",{onClick:Y,className:"btn-secondary",children:"Sign Out"})})]})}),f&&(0,s.jsxs)("div",{className:"error-container",children:[(0,s.jsx)("h2",{children:"No Questions Yet"}),(0,s.jsx)("p",{children:f}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"btn-secondary",style:{marginTop:"1rem"},children:"Refresh"})]}),e.length>0&&!F&&!f&&(0,s.jsxs)("div",{className:"question-form",children:[(0,s.jsx)("div",{className:"progress-indicator",children:(0,s.jsx)("div",{className:"progress-dots-container",children:e.map((e,a)=>(0,s.jsx)("div",{className:`
                    progress-dot 
                    ${a===U?"active":""}
                    ${a<U?"completed":""}
                  `},a))})}),(0,s.jsxs)("div",{className:"question-block",children:[(0,s.jsx)("div",{className:"question-nav-header",children:U>0&&(0,s.jsx)("button",{onClick:()=>{U>0&&O(e=>e-1)},className:"btn-back-question",children:(0,s.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/brillianse-801f7.firebasestorage.app/o/Arrow%203%20(1).png?alt=media&token=543fa238-2ab7-4906-b2c3-8d5610d9119c",alt:"Back"})})}),(0,s.jsx)("p",{className:"question-text",children:e[U]}),(0,s.jsxs)("div",{className:"button-group",children:[(0,s.jsx)("button",{type:"button",className:`btn-answer ${"yes"===c[U]?"selected":""}`,onClick:()=>B(U,"yes"),children:"Yes"}),(0,s.jsx)("button",{type:"button",className:`btn-answer ${"no"===c[U]?"selected":""}`,onClick:()=>B(U,"no"),children:"No"})]})]})]})]})}e.s(["default",()=>u])}]);